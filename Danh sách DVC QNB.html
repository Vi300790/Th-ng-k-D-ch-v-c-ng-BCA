<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Qu·∫£n l√Ω ng∆∞·ªùi ƒë·∫øn li√™n h·ªá c√¥ng t√°c - C√¥ng an ph∆∞·ªùng Quy Nh∆°n B·∫Øc</title>
  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
  <script src="https://unpkg.com/html5-qrcode"></script>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-green-50 min-h-screen flex flex-col items-center py-6">
  <!-- Header -->
  <div class="flex flex-col items-center mb-6">
    <img src="LOGO QNB.png" alt="Logo C√¥ng an ph∆∞·ªùng Quy Nh∆°n B·∫Øc" class="w-24 mb-3">
    <h1 class="text-2xl font-bold text-green-800 uppercase">C√¥ng an ph∆∞·ªùng Quy Nh∆°n B·∫Øc</h1>
    <h2 class="text-lg text-green-700">·ª®ng d·ª•ng qu·∫£n l√Ω ng∆∞·ªùi ƒë·∫øn li√™n h·ªá c√¥ng t√°c</h2>
  </div>

  <!-- Input Form -->
  <div class="bg-white shadow-lg rounded-2xl p-6 w-11/12 md:w-2/3 lg:w-1/2">
    <div class="flex flex-col gap-3">
      <input id="nameInput" type="text" placeholder="Nh·∫≠p h·ªç t√™n ng∆∞·ªùi ƒë·∫øn..." 
             class="border rounded-lg p-3 w-full focus:ring-2 focus:ring-green-600 outline-none">
      <button onclick="addVisitor()" 
              class="bg-green-700 text-white py-2 rounded-lg hover:bg-green-800 transition">Th√™m v√†o danh s√°ch</button>
      <button onclick="startQR()" 
              class="bg-green-500 text-white py-2 rounded-lg hover:bg-green-600 transition">üì∑ Qu√©t m√£ QR</button>
      <div id="qr-reader" class="hidden mt-4"></div>
    </div>
  </div>

  <!-- Filter and Actions -->
  <div class="mt-6 flex flex-wrap justify-center gap-3">
    <input id="filterDate" type="date" class="border p-2 rounded-lg">
    <button onclick="filterByDate()" class="bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700">L·ªçc theo ng√†y</button>
    <button onclick="exportToExcel()" class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700">üìÅ Xu·∫•t Excel</button>
    <button onclick="clearList()" class="bg-red-600 text-white px-4 py-2 rounded-lg hover:bg-red-700">üóëÔ∏è X√≥a danh s√°ch</button>
  </div>

  <!-- Table -->
  <div class="mt-6 w-11/12 md:w-2/3 lg:w-1/2 bg-white shadow rounded-2xl overflow-hidden">
    <table class="w-full border-collapse">
      <thead class="bg-green-700 text-white">
        <tr>
          <th class="p-2 text-left">STT</th>
          <th class="p-2 text-left">H·ªç v√† t√™n</th>
          <th class="p-2 text-left">Th·ªùi gian ƒë·∫øn</th>
        </tr>
      </thead>
      <tbody id="visitorList" class="divide-y"></tbody>
    </table>
  </div>

  <script>
    let visitors = JSON.parse(localStorage.getItem("visitors")) || [];

    function saveData() {
      localStorage.setItem("visitors", JSON.stringify(visitors));
    }

    function displayVisitors(list = visitors) {
      const tbody = document.getElementById("visitorList");
      tbody.innerHTML = "";
      list
        .sort((a, b) => new Date(a.time) - new Date(b.time))
        .forEach((v, i) => {
          const row = `<tr class="hover:bg-green-50">
            <td class="p-2">${i + 1}</td>
            <td class="p-2">${v.name}</td>
            <td class="p-2">${new Date(v.time).toLocaleString("vi-VN")}</td>
          </tr>`;
          tbody.innerHTML += row;
        });
    }

    function addVisitor(name = null) {
      const input = document.getElementById("nameInput");
      const visitorName = name || input.value.trim();
      if (visitorName === "") {
        alert("Vui l√≤ng nh·∫≠p h·ªç t√™n!");
        return;
      }
      const newVisitor = { name: visitorName, time: new Date().toISOString() };
      visitors.push(newVisitor);
      saveData();
      displayVisitors();
      input.value = "";
    }

    function clearList() {
      if (confirm("B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a to√†n b·ªô danh s√°ch h√¥m nay?")) {
        visitors = [];
        saveData();
        displayVisitors();
      }
    }

    function exportToExcel() {
      if (visitors.length === 0) {
        alert("Danh s√°ch tr·ªëng, kh√¥ng th·ªÉ xu·∫•t!");
        return;
      }
      const data = visitors.map((v, i) => ({
        STT: i + 1,
        "H·ªç v√† t√™n": v.name,
        "Th·ªùi gian ƒë·∫øn": new Date(v.time).toLocaleString("vi-VN")
      }));
      const worksheet = XLSX.utils.json_to_sheet(data);
      const workbook = XLSX.utils.book_new();
      XLSX.utils.book_append_sheet(workbook, worksheet, "Danh s√°ch");
      XLSX.writeFile(workbook, "Danh_sach_nguoi_den.xlsx");
    }

    function filterByDate() {
      const dateInput = document.getElementById("filterDate").value;
      if (!dateInput) {
        displayVisitors();
        return;
      }
      const filtered = visitors.filter(v => v.time.startsWith(dateInput));
      displayVisitors(filtered);
    }

    function startQR() {
      const qrContainer = document.getElementById("qr-reader");
      qrContainer.classList.toggle("hidden");
      if (!qrContainer.classList.contains("hidden")) {
        const html5QrCode = new Html5Qrcode("qr-reader");
        html5QrCode.start(
          { facingMode: "environment" },
          { fps: 10, qrbox: 250 },
          (decodedText) => {
            addVisitor(decodedText);
            html5QrCode.stop();
            qrContainer.classList.add("hidden");
          },
          (errorMessage) => {}
        );
      }
    }

    displayVisitors();
  </script>
</body>
</html>
